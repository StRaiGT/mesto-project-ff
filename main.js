(()=>{"use strict";function e(e,n,r,o,a,c){var i=e.content.querySelector(".card").cloneNode(!0);i.querySelector(".card__title").textContent=n.name,i.dataset.cardId=n._id,i.dataset.cardOwnerId=n.owner._id;var u=i.querySelector(".card__image");u.src=n.link,u.alt=n.name,u.addEventListener("click",a);var l=i.querySelector(".card__like-counter");l.textContent=n.likes.length;var s=i.querySelector(".card__like-button");n.likes.some((function(e){return e._id===r}))&&t(s),s.addEventListener("click",(function(){c(i.dataset.cardId,s,l)}));var d=i.querySelector(".card__delete-button");return r===n.owner._id?d.addEventListener("click",(function(){o(i)})):d.remove(),i}function t(e){e.classList.toggle("card__like-button_is-active")}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function a(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(r),t.classList.remove(n)}function c(e,t){e.disabled=!0,e.classList.add(t)}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t)}(t,n):c(t,n)}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t.inputErrorClass,t.errorClass)})),c(r,t.inactiveButtonClass)}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-14",headers:{authorization:"a52cfbf8-543b-4585-8f12-92e5a6a3781d","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Ошибка ответа сервера: ".concat(e.status))},d=function(e,t){return fetch(e,t).then(s)};function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=document.querySelectorAll(".popup"),m=document.querySelector(".places__list"),_=document.querySelector(".profile__info"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),h=v.querySelector(".popup__input_type_name"),S=v.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),E=document.querySelector(".profile__image-edit-button"),L=document.forms["update-profile-image"],C=document.querySelector(".popup_type_update-profile-image"),k=document.querySelector("#card-template"),A=document.forms["new-place"],x=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_new-card"),w=I.querySelector(".popup__input_type_card-name"),U=I.querySelector(".popup__input_type_url"),O=document.querySelector(".popup_type_confirm-delete-card"),j=O.querySelector(".popup__button"),T=document.querySelector(".popup_type_image"),D=document.querySelector(".popup__image"),B=document.querySelector(".popup__caption"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function M(e){D.src=e.target.src,D.alt=e.target.alt,B.textContent=e.target.alt,n(T)}function N(e){O.dataset.cardId=e.dataset.cardId,n(O)}function J(e,n,r){(n.classList.contains("card__like-button_is-active")?function(e){return d("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers})}(e):function(e){return d("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers})}(e)).then((function(e){r.textContent=e.likes.length,t(n)})).catch((function(e){console.log("Ошибка обновления лайка: "+e)}))}function H(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}f.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close"))&&r(e)}))})),E.addEventListener("click",(function(){L.reset(),u(C,P),n(C)})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),H(C,!0),(t=L.elements["profile-image-input"].value,d("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})})).then((function(e){q.style="background-image: url(".concat(e.avatar,")"),r(C)})).catch((function(e){console.log("Ошибка обновления аватара: "+e)})).finally((function(){H(C,!1)}))})),y.addEventListener("click",(function(){u(v,P),h.value=b.textContent,S.value=g.textContent,n(v)})),v.addEventListener("submit",(function(e){var t;e.preventDefault(),H(v,!0),(t={name:h.value,about:S.value},d("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t.name,about:t.about})})).then((function(){b.textContent=h.value,g.textContent=S.value,r(v)})).catch((function(e){console.log("Ошибка обновления данных профиля: "+e)})).finally((function(){H(v,!1)}))})),x.addEventListener("click",(function(){A.reset(),u(I,P),n(I)})),I.addEventListener("submit",(function(t){var n;t.preventDefault(),H(I,!0),(n={name:w.value,link:U.value},d("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:n.name,link:n.link})})).then((function(t){var n=e(k,t,_.dataset.profileId,N,M,J);m.prepend(n),r(I)})).catch((function(e){console.log("Ошибка добавления новой карточки: "+e)})).finally((function(){H(I,!1)}))})),j.addEventListener("click",(function(e){e.preventDefault();var t,n=document.querySelector('[data-card-id="'.concat(O.dataset.cardId,'"]'));(t=n.dataset.cardId,d("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers})).then((function(){n.remove(),r(O)})).catch((function(e){console.log("Ошибка удаления карточки: "+e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c){var u=Array.from(e.querySelectorAll(t)),l=e.querySelector(n);i(u,l,r),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,n,r):function(e,t,n,r,o){var a=e.querySelector(".".concat(t.id,"-error"));a.textContent=n,a.classList.add(o),t.classList.add(r)}(e,t,t.validationMessage,n,r)}(e,t,o,c),i(u,l,r)}))}))}(t,e.inputSelector,e.submitButtonSelector,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(P),Promise.all([d("".concat(l.baseUrl,"/users/me"),{headers:l.headers}),d("".concat(l.baseUrl,"/cards"),{headers:l.headers})]).then((function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];_.dataset.profileId=a._id,b.textContent=a.name,g.textContent=a.about,q.style="background-image: url(".concat(a.avatar,")"),c.forEach((function(t){var n=e(k,t,_.dataset.profileId,N,M,J);m.append(n)}))})).catch((function(e){console.log("Ошибка получения первичных данных: "+e)}))})();